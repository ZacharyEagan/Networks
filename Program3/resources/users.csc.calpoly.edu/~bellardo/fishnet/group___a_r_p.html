<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Fishnet: ARP Functionality</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ARP Functionality</h1>
<p>Functions and types that implemented the fishnet ARP functionality.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfishnet__arp__functions.html">fishnet_arp_functions</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions for interacting with the ARP cache and resolving L3 addresses into L2 addresses.  <a href="structfishnet__arp__functions.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#ga29e21b98d1d024b2d67edb363b7bba4e">arp_resolution_cb</a> )(<a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a> addr, void *param)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Function signature for the ARP resolution callback.  <a href="#ga29e21b98d1d024b2d67edb363b7bba4e"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#gad60541e12f4ff3940997b6ffa9c303ee">fish_print_arp_table</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function prints the contents of the ARP table maintained by the built-in implementation of ARP.  <a href="#gad60541e12f4ff3940997b6ffa9c303ee"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#ga88835eebac9456cc7dfcb3c040a4b165">fishnet_arp_functions::add_arp_entry</a> )(<a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a> l2addr, <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> addr, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an entry to the ARP cache.  <a href="#ga88835eebac9456cc7dfcb3c040a4b165"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1">fishnet_arp_functions::resolve_fnaddr</a> )(<a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> addr, <a class="el" href="group___a_r_p.html#ga29e21b98d1d024b2d67edb363b7bba4e">arp_resolution_cb</a> cb, void *param)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function resolves a L3 address into the corresponding L2 address.  <a href="#ga56060b595d7800857c9af70f120fc0e1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#gab7728f145c0bec7b4a6b0036a242d089">fishnet_arp_functions::arp_received</a> )(void *l2frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function pointer gets called when an ARP frame arrives at the node for processing.  <a href="#gab7728f145c0bec7b4a6b0036a242d089"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#gaa39abf5685e91c79b2a1b8935a8a0cd7">fishnet_arp_functions::send_arp_request</a> )(<a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> l3addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function creates and sends an ARP request for the given L3i address.  <a href="#gaa39abf5685e91c79b2a1b8935a8a0cd7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structfishnet__arp__functions.html">fishnet_arp_functions</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___a_r_p.html#gaae010e0d6fe3eb5ce01ad407125e71a5">fish_arp</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions for interacting with the ARP cache and resolving L3 addresses into L2 addresses.  <a href="#gaae010e0d6fe3eb5ce01ad407125e71a5"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Functions and types that implemented the fishnet ARP functionality. </p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga29e21b98d1d024b2d67edb363b7bba4e"></a><!-- doxytag: member="fish.h::arp_resolution_cb" ref="ga29e21b98d1d024b2d67edb363b7bba4e" args=")(fn_l2addr_t addr, void *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* <a class="el" href="group___a_r_p.html#ga29e21b98d1d024b2d67edb363b7bba4e">arp_resolution_cb</a>)(<a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a> addr, void *param)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Function signature for the ARP resolution callback. </p>
<ul>
<li><code>addr</code> The L2 address corresponding to the L3 address being resolved. If the resolution failed this will be the invalid L2 address. Test with the macro <a class="el" href="group___l2.html#gaf1eb9eb5c409012cc272dbf6eb7859f9" title="A macro that tests the validity of a fishnet layer 2 address.">FNL2_VALID()</a>. </li>
<li><code>param</code> The param value passed to <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a>. It is passed unchanged into the ARP completion callback. </li>
</ul>

<p>Definition at line <a class="el" href="fish_8h_source.html#l00818">818</a> of file <a class="el" href="fish_8h_source.html">fish.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gad60541e12f4ff3940997b6ffa9c303ee"></a><!-- doxytag: member="fish.h::fish_print_arp_table" ref="gad60541e12f4ff3940997b6ffa9c303ee" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fish_print_arp_table </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This function prints the contents of the ARP table maintained by the built-in implementation of ARP. </p>
<p>This function is meant as a debugging and development aid to help you understand why your node is not working correctly. It only displays the contents of the built-in ARP table. If you provide your own ARP table implementation this function is useless. </p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga88835eebac9456cc7dfcb3c040a4b165"></a><!-- doxytag: member="fishnet_arp_functions::add_arp_entry" ref="ga88835eebac9456cc7dfcb3c040a4b165" args=")(fn_l2addr_t l2addr, fnaddr_t addr, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* <a class="el" href="group___a_r_p.html#ga88835eebac9456cc7dfcb3c040a4b165">fishnet_arp_functions::add_arp_entry</a>)(<a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a> l2addr, <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> addr, int timeout)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add an entry to the ARP cache. </p>
<ul>
<li><code>l2addr</code> The L2 address of the new entry. </li>
<li><code>addr</code> The L3 address of the new entry. </li>
<li><code>timeout</code> The length of time the entry remains valid, in seconds.</li>
</ul>
<p>The entry defines a mapping between the supplied L3 and L2 addresses. If an for the &lt;L3, L2&gt; pair already exists then the timeout value is reset to the value passed into the function. </p>

</div>
</div>
<a class="anchor" id="gab7728f145c0bec7b4a6b0036a242d089"></a><!-- doxytag: member="fishnet_arp_functions::arp_received" ref="gab7728f145c0bec7b4a6b0036a242d089" args=")(void *l2frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* <a class="el" href="group___a_r_p.html#gab7728f145c0bec7b4a6b0036a242d089">fishnet_arp_functions::arp_received</a>)(void *l2frame)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This function pointer gets called when an ARP frame arrives at the node for processing. </p>
<ul>
<li><code>l2frame</code> A pointer to the L2 frame containing the ARP packet.</li>
</ul>
<p>The function is responsible for generating and processing ARP responses. It is necessary to call fish_arp::add_arp_entry as part of processing an ARP response. There is a built-in L2 handler that calls this function for every ARP packet destined to this fishnode. The built-in handler AUTOMATICALLY DISABLES ITSELF when you provide a pointer to your own arp_received implementation. You must add code to fish_l2::fishnode_l2_receive to call this function if you override this function! </p>

</div>
</div>
<a class="anchor" id="gaae010e0d6fe3eb5ce01ad407125e71a5"></a><!-- doxytag: member="fish.h::fish_arp" ref="gaae010e0d6fe3eb5ce01ad407125e71a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structfishnet__arp__functions.html">fishnet_arp_functions</a>  <a class="el" href="group___a_r_p.html#gaae010e0d6fe3eb5ce01ad407125e71a5">fish_arp</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Functions for interacting with the ARP cache and resolving L3 addresses into L2 addresses. </p>
<p>This structure contains function pointers that implement all ARP related operations. These are provided as function pointers to allow the fishnode to override the built-in implementations with its own implementation(s). These fields are initialized to point to the libfish built-in implementations of the functions.</p>
<p>There is a single instance of this structure in a fishnode. It is a global variable named fish_arp. You can access the fields directly in any portion of your code (e.g., fish_arp.resolve_fnaddr = NULL) to change the value of the function pointers or to call them. Do not declare an instance of this structure yourself. </p>

</div>
</div>
<a class="anchor" id="ga56060b595d7800857c9af70f120fc0e1"></a><!-- doxytag: member="fishnet_arp_functions::resolve_fnaddr" ref="ga56060b595d7800857c9af70f120fc0e1" args=")(fnaddr_t addr, arp_resolution_cb cb, void *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1">fishnet_arp_functions::resolve_fnaddr</a>)(<a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> addr, <a class="el" href="group___a_r_p.html#ga29e21b98d1d024b2d67edb363b7bba4e">arp_resolution_cb</a> cb, void *param)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This function resolves a L3 address into the corresponding L2 address. </p>
<ul>
<li><code>addr</code> The L3 address to resolve. </li>
<li><code>cb</code> The callback function to call once the resolution is complete. </li>
<li><code>param</code> An opaque additional parameter to pass to the callback function when it gets called. I strongly encourage you to pass the pointer to your L2 frame via this parameter.</li>
</ul>
<p>This function does not return the L2 address via a return value. Instead it calls the callback function <code>cb</code> once the mapping is known. This is necessary because it may require many seconds to realize a L3 address is not on the same L2 network. You must supply your own <code>cb</code> function to call <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a>. A NULL value is not sufficient.</p>
<p>When <code>cb</code> is called, the value passed in via the <code>param</code> parameter is passed unmodified to <code>cb</code>. You can use this to communicate as much information as necessary to the callback without resorting to global variables. <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a> will not modify <code>param</code> nor will it free <code>param</code> after the callback is called. If you allocate <code>param</code> from the heap the callback is responsible for freeing it before the callback returns. In the event an ARP lookup is unsuccessful the callback is called with an invalid L2 address (the <a class="el" href="group___l2.html#gaf1eb9eb5c409012cc272dbf6eb7859f9" title="A macro that tests the validity of a fishnet layer 2 address.">FNL2_VALID()</a> macro tests for an invalid L2 address). This is important to permit the callback to free any heap-allocated memory associated with <code>param</code>.</p>
<p>If the L3 to L2 address mapping is cached and hasn't expired, the callback function is called immediately with the mapping. This occurs before <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a> returns.</p>
<p>If the mapping is NOT present in the cache, an ARP lookup is initiated for the L3 address and the first ARP request is sent using the <a class="el" href="group___a_r_p.html#gaa39abf5685e91c79b2a1b8935a8a0cd7" title="This function creates and sends an ARP request for the given L3i address.">fishnet_arp_functions::send_arp_request</a> function. The callback is not called immediately. Instead the callback wil be called once the corresponding ARP response has been received (typically 100 ms), or after all ARP retries have been attempted and there is still no answer (at least 10 seconds). <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a> returns immediately in this case.</p>
<p>During this potentially long interval it is necessary for the fishnode to continue processing packets, otherwise it won't receive the ARP response. In order to process packets, the function that calls <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a> must return immediately after <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a> returns. Therefore it is very important that there is no amount of code after the call to <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a>. In particular, do NOT write code that assumes <code>cb</code> has been called before <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a> returns and do not loop waiting for <code>cb</code> to be called after calling <a class="el" href="group___a_r_p.html#ga56060b595d7800857c9af70f120fc0e1" title="This function resolves a L3 address into the corresponding L2 address.">fishnet_arp_functions::resolve_fnaddr</a>. </p>

</div>
</div>
<a class="anchor" id="gaa39abf5685e91c79b2a1b8935a8a0cd7"></a><!-- doxytag: member="fishnet_arp_functions::send_arp_request" ref="gaa39abf5685e91c79b2a1b8935a8a0cd7" args=")(fnaddr_t l3addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* <a class="el" href="group___a_r_p.html#gaa39abf5685e91c79b2a1b8935a8a0cd7">fishnet_arp_functions::send_arp_request</a>)(<a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> l3addr)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This function creates and sends an ARP request for the given L3i address. </p>
<ul>
<li><code>l3addr</code> The L3 address to send an ARP request for.</li>
</ul>
<p>This function is called as part of fish_arp::resolve_fnaddr when no entry is present in the ARP cache. It must create and send an appropiate ARP request frame. </p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 14 Jan 2014 for Fishnet by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
