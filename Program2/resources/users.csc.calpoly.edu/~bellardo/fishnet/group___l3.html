<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Fishnet: L3 Functionality</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>L3 Functionality</h1>
<p>Functions, data structures, and constants that relate to implementing fishnet layer 3 functionality in a fishnode.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_fishnet_l3_funcs.html">FishnetL3Funcs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions for sending and receiving layer 3 frames.  <a href="struct_fishnet_l3_funcs.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga843f582b945ff08ad64483d574123502">ALL_NEIGHBORS</a>&nbsp;&nbsp;&nbsp;htonl(0xFFFFFFFF)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This Fishnet address allows you use fish_send() to send a frame to all immediate neighbors.  <a href="#ga843f582b945ff08ad64483d574123502"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga7224cc1e84435ca6a8da91c22295d1b2">MAX_TTL</a>&nbsp;&nbsp;&nbsp;64</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The time-to-live or TTL limits the number of hops a packet can take, in order to prevent loops.  <a href="#ga7224cc1e84435ca6a8da91c22295d1b2"></a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The type definition for a fishnet L3 address.  <a href="#ga56eb193582cf90391b0719f7ec51bde1"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga62d26bfc7d88690312b270185d0b6dc3">fish_sendto_l3_builtin</a> (void *l3frame, int len, int mine)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a L3 frame (including full L3 header) to the libfish built-in protocol implementations.  <a href="#ga62d26bfc7d88690312b270185d0b6dc3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga394166aceff63db6a684fbfde45781a5">fish_sendto_l3_apps</a> (void *l3frame, int len, int mine)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a L3 frame to applications that are attached to this node.  <a href="#ga394166aceff63db6a684fbfde45781a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga25f9373ccce11ba0ffbb6b4ce2c0891e">fish_next_pktid</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the next unique packet ID to be included in the L3 header in host byte order.  <a href="#ga25f9373ccce11ba0ffbb6b4ce2c0891e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#gab1075d48bdb9e73744434bc22b3b6818">fn_ntoa</a> (<a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Converts a L3 address into a printable c-string.  <a href="#gab1075d48bdb9e73744434bc22b3b6818"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga76232e4f4c7d2b47b7159f6918c532eb">fn_aton</a> (const char *addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Converts a c-string L3 address into a fnaddr_t.  <a href="#ga76232e4f4c7d2b47b7159f6918c532eb"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#gac59c4c605b53588717f1fd2697ff45bf">FishnetL3Funcs::fish_l3_receive</a> )(void *l3frame, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive a new layer 3 frame from the layer 2 code.  <a href="#gac59c4c605b53588717f1fd2697ff45bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga9784e0492c873f3b411e694462368321">FishnetL3Funcs::fishnode_l3_receive</a> )(void *l3frame, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receives a new layer 3 frame from <a class="el" href="group___l3.html#gac59c4c605b53588717f1fd2697ff45bf" title="Receive a new layer 3 frame from the layer 2 code.">FishnetL3Funcs::fish_l3_receive</a>. Decapsulates the frame and forwards it or passes it the L4 as needed.  <a href="#ga9784e0492c873f3b411e694462368321"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga6352003877c4c4c8bdcd454099b90398">FishnetL3Funcs::fish_l3_send</a> )(void *l4frame, int len, <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> dst_addr, uint8_t proto, uint8_t ttl)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receives a new L4 frame to be sent over the network.  <a href="#ga6352003877c4c4c8bdcd454099b90398"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga41468a464b20e55ad71403bd6fd0177d">FishnetL3Funcs::fish_l3_forward</a> )(void *l3frame, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Takes an already-encapsulated L3 frame, looks up the destination in the forwarding table, and passes the frame off to L2.  <a href="#ga41468a464b20e55ad71403bd6fd0177d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="struct_fishnet_l3_funcs.html">FishnetL3Funcs</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l3.html#ga62401265a634aaba1923d6edf6b94842">fish_l3</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions for sending and receiving layer 3 frames.  <a href="#ga62401265a634aaba1923d6edf6b94842"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Functions, data structures, and constants that relate to implementing fishnet layer 3 functionality in a fishnode. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga843f582b945ff08ad64483d574123502"></a><!-- doxytag: member="fish.h::ALL_NEIGHBORS" ref="ga843f582b945ff08ad64483d574123502" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALL_NEIGHBORS&nbsp;&nbsp;&nbsp;htonl(0xFFFFFFFF)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This Fishnet address allows you use fish_send() to send a frame to all immediate neighbors. </p>

<p>Definition at line <a class="el" href="fish_8h_source.html#l00069">69</a> of file <a class="el" href="fish_8h_source.html">fish.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga7224cc1e84435ca6a8da91c22295d1b2"></a><!-- doxytag: member="fish.h::MAX_TTL" ref="ga7224cc1e84435ca6a8da91c22295d1b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_TTL&nbsp;&nbsp;&nbsp;64</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The time-to-live or TTL limits the number of hops a packet can take, in order to prevent loops. </p>

<p>Definition at line <a class="el" href="fish_8h_source.html#l00084">84</a> of file <a class="el" href="fish_8h_source.html">fish.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga56eb193582cf90391b0719f7ec51bde1"></a><!-- doxytag: member="fish.h::fnaddr_t" ref="ga56eb193582cf90391b0719f7ec51bde1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The type definition for a fishnet L3 address. </p>

<p>Definition at line <a class="el" href="fish_8h_source.html#l00035">35</a> of file <a class="el" href="fish_8h_source.html">fish.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga25f9373ccce11ba0ffbb6b4ce2c0891e"></a><!-- doxytag: member="fish.h::fish_next_pktid" ref="ga25f9373ccce11ba0ffbb6b4ce2c0891e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t fish_next_pktid </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the next unique packet ID to be included in the L3 header in host byte order. </p>

</div>
</div>
<a class="anchor" id="ga394166aceff63db6a684fbfde45781a5"></a><!-- doxytag: member="fish.h::fish_sendto_l3_apps" ref="ga394166aceff63db6a684fbfde45781a5" args="(void *l3frame, int len, int mine)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fish_sendto_l3_apps </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>l3frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mine</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a L3 frame to applications that are attached to this node. </p>
<ul>
<li><code>l3frame</code> A pointer to the L3 frame. The contents will not be modified and the memory will not be freed. </li>
<li><code>len</code> The length of the L3 frame </li>
<li><code>mine</code> A boolean flag that indicates if the L3 packet should be processed by this node.</li>
</ul>
<p>Sends a L3 frame (including full L3 header) to the application(s) attached to the fishnode. This enables applications like ping and traceroute to receive packets. </p>

</div>
</div>
<a class="anchor" id="ga62d26bfc7d88690312b270185d0b6dc3"></a><!-- doxytag: member="fish.h::fish_sendto_l3_builtin" ref="ga62d26bfc7d88690312b270185d0b6dc3" args="(void *l3frame, int len, int mine)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fish_sendto_l3_builtin </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>l3frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mine</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a L3 frame (including full L3 header) to the libfish built-in protocol implementations. </p>
<ul>
<li><code>l3frame</code> A pointer to the L3 frame. The contents will not be modified and the memory will not be freed. </li>
<li><code>len</code> The length of the L3 frame </li>
<li><code>mine</code> A boolean flag that indicates if the L3 packet should be processed by this node. <dl class="return"><dt><b>Returns:</b></dt><dd>true if the built-in implementations "consumed" the frame and false otherwise. A consumed frame must not be sent up the protocol stack.</dd></dl>
This functions attempts to match the L3 frame to one of the built-in protocol implementations. If a match is found, the implementation is given the frame and this function returns true. Otherwise this function returns false. </li>
</ul>

</div>
</div>
<a class="anchor" id="ga76232e4f4c7d2b47b7159f6918c532eb"></a><!-- doxytag: member="fish.h::fn_aton" ref="ga76232e4f4c7d2b47b7159f6918c532eb" args="(const char *addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> fn_aton </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>addr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Converts a c-string L3 address into a fnaddr_t. </p>
<ul>
<li><code>addr</code> a pointer to the c-string to convert <dl class="return"><dt><b>Returns:</b></dt><dd>The L3 address stored in a fnaddr_t </dd></dl>
</li>
</ul>

</div>
</div>
<a class="anchor" id="gab1075d48bdb9e73744434bc22b3b6818"></a><!-- doxytag: member="fish.h::fn_ntoa" ref="gab1075d48bdb9e73744434bc22b3b6818" args="(fnaddr_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* fn_ntoa </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Converts a L3 address into a printable c-string. </p>
<ul>
<li><code>addr</code> The L3 address to convert <dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the c-string that contains the L3 address</dd></dl>
Warning - This function places the string into a static buffer, so if you call this function twice it will overwrite the result from the first call. Don't use this twice in the same call to printf()! </li>
</ul>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga62401265a634aaba1923d6edf6b94842"></a><!-- doxytag: member="fish.h::fish_l3" ref="ga62401265a634aaba1923d6edf6b94842" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="struct_fishnet_l3_funcs.html">FishnetL3Funcs</a>  <a class="el" href="group___l3.html#ga62401265a634aaba1923d6edf6b94842">fish_l3</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Functions for sending and receiving layer 3 frames. </p>
<p>This structure contains function pointers that implement all layer 3 transmit and receive operations. Layer 3 frames have the layer 3 header and any layer 3 payload. These are provided as function pointers to allow the fishnode to override the built-in implementations with its own implementation(s).</p>
<p>There is a single instance of this structure in a fishnode. It is a global variable named fish_l3. You can access the fields directly in any portion of your code (e.g., fish_l3.fishnode_l3_receive = NULL) to change the value of the function pointers or to call them. Do not declare an instance of this structure yourself. </p>

</div>
</div>
<a class="anchor" id="ga41468a464b20e55ad71403bd6fd0177d"></a><!-- doxytag: member="FishnetL3Funcs::fish_l3_forward" ref="ga41468a464b20e55ad71403bd6fd0177d" args=")(void *l3frame, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l3.html#ga41468a464b20e55ad71403bd6fd0177d">FishnetL3Funcs::fish_l3_forward</a>)(void *l3frame, int len)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Takes an already-encapsulated L3 frame, looks up the destination in the forwarding table, and passes the frame off to L2. </p>
<ul>
<li><code>l3frame</code> A pointer to the L3 frame. Note that this is different than fish_l3_send which takes a L4 frame. The original frame memory must not be modified. The caller is responsible for freeing any memory after this function has completed. </li>
<li><code>len</code> The length of the L3 frame. <dl class="return"><dt><b>Returns:</b></dt><dd>false if the send is known to have failed (e.g., TTL exceeded) and true otherwise.</dd></dl>
fish_l3_forward is given a L3 encapsulated frame and is responsible for delivering it. This requires the following steps: </li>
<li>If the TTL is 0 and the destination is not local, drop the packet and generate the correct FCMP error message. </li>
<li>Lookup the L3 destination in the forwarding table. </li>
<li>If there is no route to the destination, drop the frame and generate the correct FCMP error. </li>
<li>Use fish_l2_send to send the frame to the next-hop neighbor indicated by the forwarding table.</li>
</ul>
<p>This function may be called from a number of other places in the code, including fish_l3_send and fishnode_l3_receive. </p>

</div>
</div>
<a class="anchor" id="gac59c4c605b53588717f1fd2697ff45bf"></a><!-- doxytag: member="FishnetL3Funcs::fish_l3_receive" ref="gac59c4c605b53588717f1fd2697ff45bf" args=")(void *l3frame, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l3.html#gac59c4c605b53588717f1fd2697ff45bf">FishnetL3Funcs::fish_l3_receive</a>)(void *l3frame, int len)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive a new layer 3 frame from the layer 2 code. </p>
<ul>
<li><code>l3frame</code> A pointer to the received L3 frame. The frame must not be modified. The caller will free the memory for the frame as necessary. </li>
<li><code>The</code> length of the layer 3 frame, in host byte order <dl class="return"><dt><b>Returns:</b></dt><dd>false if the receive is known to have failed and true otherwise.</dd></dl>
This function is the main function responsible for accepting new L3 packets from the L2 code. It is responsible for calling <a class="el" href="group___l3.html#ga394166aceff63db6a684fbfde45781a5" title="Sends a L3 frame to applications that are attached to this node.">fish_sendto_l3_apps()</a>, <a class="el" href="group___l3.html#ga62d26bfc7d88690312b270185d0b6dc3" title="Sends a L3 frame (including full L3 header) to the libfish built-in protocol implementations...">fish_sendto_l3_builtin()</a>, and <a class="el" href="group___l3.html#ga9784e0492c873f3b411e694462368321" title="Receives a new layer 3 frame from FishnetL3Funcs::fish_l3_receive. Decapsulates the...">fishnode_l3_receive()</a>, in that order. It does nothing more than call those 3 functions. </li>
</ul>

</div>
</div>
<a class="anchor" id="ga6352003877c4c4c8bdcd454099b90398"></a><!-- doxytag: member="FishnetL3Funcs::fish_l3_send" ref="ga6352003877c4c4c8bdcd454099b90398" args=")(void *l4frame, int len, fnaddr_t dst_addr, uint8_t proto, uint8_t ttl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l3.html#ga6352003877c4c4c8bdcd454099b90398">FishnetL3Funcs::fish_l3_send</a>)(void *l4frame, int len, <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> dst_addr, uint8_t proto, uint8_t ttl)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receives a new L4 frame to be sent over the network. </p>
<ul>
<li><code>l4frame</code> A pointer to the L4 frame. The original frame memory must not be modified. The caller is responsible for freeing any memory after this function has completed. </li>
<li><code>len</code> The length of the L4 frame </li>
<li><code>dst_addr</code> The L3 address of the final destination for this frame. </li>
<li><code>proto</code> The fishnet protocol number of the L4 frame </li>
<li><code>ttl</code> The TTL for the frame, or 0 to use the maximum TTL. If the TTL is greater than the maximum TTL, set it to the maximum TTL. <dl class="return"><dt><b>Returns:</b></dt><dd>false if the send is known to have failed and true otherwise.</dd></dl>
This functoin is responsible for encapsulating a L4 frame in a L3 header and then forwarding the packet through the fishnet. Forwarding is accomplished by calling the <a class="el" href="group___l3.html#ga41468a464b20e55ad71403bd6fd0177d" title="Takes an already-encapsulated L3 frame, looks up the destination in the forwarding...">fish_l3_forward()</a> function. </li>
</ul>

</div>
</div>
<a class="anchor" id="ga9784e0492c873f3b411e694462368321"></a><!-- doxytag: member="FishnetL3Funcs::fishnode_l3_receive" ref="ga9784e0492c873f3b411e694462368321" args=")(void *l3frame, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l3.html#ga9784e0492c873f3b411e694462368321">FishnetL3Funcs::fishnode_l3_receive</a>)(void *l3frame, int len)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receives a new layer 3 frame from <a class="el" href="group___l3.html#gac59c4c605b53588717f1fd2697ff45bf" title="Receive a new layer 3 frame from the layer 2 code.">FishnetL3Funcs::fish_l3_receive</a>. Decapsulates the frame and forwards it or passes it the L4 as needed. </p>
<ul>
<li><code>l3frame</code> A pointer to the received L3 frame. The only part of the frame that can be modified is the TTL header field. The caller will free the memory for the frame as necessary. </li>
<li><code>len</code> The length of the layer 3 frame, in host byte order <dl class="return"><dt><b>Returns:</b></dt><dd>false if the receive is known to have failed and true otherwise.</dd></dl>
This function is responsible for correctly directing packets to the higher network layers or to the forwarding engine. This requires following general steps:</li>
</ul>
<ul>
<li>If the L3 destination is the node's L3 address, remove the L3 header and pass the frame to the L4 code. </li>
<li>If the L3 destination is the broadcast address AND the frame was received by this node previously (use the compination of src L3 address and packet ID to determine this), drop the frame without sending an FCMP message. </li>
<li>Otherwise, if the L3 destination is the broadcast address, the frame must be both passed up the network stack and forwarded back out over the fishnet with a decremented TTL. </li>
<li>If the L3 addresses isn't the broadcast address and the L3 address isn't the node's address, the TTL is decremented and the frame is forwarded back over the fishnet.</li>
</ul>
<p>This is also the function that calls your implementation of fishnet L3 protocols, such as DV routing. </p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 14 Jan 2014 for Fishnet by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
