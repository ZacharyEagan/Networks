<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Fishnet: L2 Functionality</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>L2 Functionality</h1>
<p>Functions, data structures, and constants that relate to implementing fishnet layer 2 functionality in a fishnode.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The type definition for a fishnet L2 address.  <a href="structfn__l2addr__t.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_fishnet_l2_funcs.html">FishnetL2Funcs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions for transmitting and receiving L2 frames.  <a href="struct_fishnet_l2_funcs.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#gab57b16e9100cc5ae9631a2a82519caa0">FNL2_EQ</a>(x, y)&nbsp;&nbsp;&nbsp;(0 == memcmp(&amp;(x).l2addr, &amp;(y).l2addr, sizeof((x).l2addr)))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A macro that tests fishnet layer 2 addresses for equality.  <a href="#gab57b16e9100cc5ae9631a2a82519caa0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#gaf1eb9eb5c409012cc272dbf6eb7859f9">FNL2_VALID</a>(x)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A macro that tests the validity of a fishnet layer 2 address.  <a href="#gaf1eb9eb5c409012cc272dbf6eb7859f9"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#ga1fa801f4576bc4ffe79398493a63f697">fish_sendto_l2_builtin</a> (void *l2frame, int mine)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a layer 2 frame to all built-in protocol implementations that are interested in it.  <a href="#ga1fa801f4576bc4ffe79398493a63f697"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#ga418e3070cc441741aa9435e8c3683b48">fish_sendto_l2_apps</a> (void *l2frame, int mine)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a L2 frame to applications that are attached to this node.  <a href="#ga418e3070cc441741aa9435e8c3683b48"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#ga114eafd3ec0fb43a7d4785c4f3f2932e">fnl2_ntoa</a> (<a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a> addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Converts a L2 address into a printable c-string.  <a href="#ga114eafd3ec0fb43a7d4785c4f3f2932e"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#ga2df87dd135076789b17a5166d2b5e4fc">ALL_L2_NEIGHBORS</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A global that holds the L2 broadcast address.  <a href="#ga2df87dd135076789b17a5166d2b5e4fc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#gafa9566a45fa67b25adefe2ded4ca24fa">FishnetL2Funcs::fish_l2_receive</a> )(void *l2frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive a new layer 2 frame from the layer 1 code.  <a href="#gafa9566a45fa67b25adefe2ded4ca24fa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#ga2f74da6dde0fbc3cb18f5ce5a102cfb0">FishnetL2Funcs::fishnode_l2_receive</a> )(void *l2frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receives a new layer 2 frame from the layer 1 code in libfish. Decapsulates the frame and passes it up the stack as needed.  <a href="#ga2f74da6dde0fbc3cb18f5ce5a102cfb0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#gabba01bfaace8950157d419097386254f">FishnetL2Funcs::fish_l2_send</a> )(void *l3frame, <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> next_hop, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receives a new L3 frame to be sent over the network.  <a href="#gabba01bfaace8950157d419097386254f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="struct_fishnet_l2_funcs.html">FishnetL2Funcs</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l2.html#gace8427af2028b1c5e79bfa46b65624e6">fish_l2</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions for transmitting and receiving L2 frames.  <a href="#gace8427af2028b1c5e79bfa46b65624e6"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Functions, data structures, and constants that relate to implementing fishnet layer 2 functionality in a fishnode. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="gab57b16e9100cc5ae9631a2a82519caa0"></a><!-- doxytag: member="fish.h::FNL2_EQ" ref="gab57b16e9100cc5ae9631a2a82519caa0" args="(x, y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FNL2_EQ</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">y&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(0 == memcmp(&amp;(x).l2addr, &amp;(y).l2addr, sizeof((x).l2addr)))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A macro that tests fishnet layer 2 addresses for equality. </p>
<ul>
<li><code>x</code> , <code>y</code> Are both <a class="el" href="structfn__l2addr__t.html" title="The type definition for a fishnet L2 address.">fn_l2addr_t</a> structures (not pointers). <dl class="return"><dt><b>Returns:</b></dt><dd>The macro evaluates to true if the addresses are the same and false otherwise. </dd></dl>
</li>
</ul>

<p>Definition at line <a class="el" href="fish_8h_source.html#l00053">53</a> of file <a class="el" href="fish_8h_source.html">fish.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaf1eb9eb5c409012cc272dbf6eb7859f9"></a><!-- doxytag: member="fish.h::FNL2_VALID" ref="gaf1eb9eb5c409012cc272dbf6eb7859f9" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FNL2_VALID</td>
          <td>(</td>
          <td class="paramtype">x&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">((x).l2addr[0] != 0 || (x).l2addr[1] != 0 || \
      (x).l2addr[2] != 0 || (x).l2addr[3] != 0 || (x).l2addr[4] != 0 || \
      (x).l2addr[5] != 0)
</pre></div>
<p>A macro that tests the validity of a fishnet layer 2 address. </p>
<ul>
<li><code>x</code> A <a class="el" href="structfn__l2addr__t.html" title="The type definition for a fishnet L2 address.">fn_l2addr_t</a> structure (not a pointer) to test for validity <dl class="return"><dt><b>Returns:</b></dt><dd>true if the address is valid, false otherwise. </dd></dl>
</li>
</ul>

<p>Definition at line <a class="el" href="fish_8h_source.html#l00060">60</a> of file <a class="el" href="fish_8h_source.html">fish.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga418e3070cc441741aa9435e8c3683b48"></a><!-- doxytag: member="fish.h::fish_sendto_l2_apps" ref="ga418e3070cc441741aa9435e8c3683b48" args="(void *l2frame, int mine)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fish_sendto_l2_apps </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>l2frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mine</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a L2 frame to applications that are attached to this node. </p>
<ul>
<li><code>l2frame</code> A pointer to the L2 frame. The contents will not be modified and the memory will not be freed. </li>
<li><code>mine</code> A boolean flag that indicates if the L2 packet should be processed by this node.</li>
</ul>
<p>Sends a L2 frame (including full L2 header) to the application(s) attached to the fishnode. This enables applications like fishdump to receive raw fishnet frames. </p>

</div>
</div>
<a class="anchor" id="ga1fa801f4576bc4ffe79398493a63f697"></a><!-- doxytag: member="fish.h::fish_sendto_l2_builtin" ref="ga1fa801f4576bc4ffe79398493a63f697" args="(void *l2frame, int mine)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fish_sendto_l2_builtin </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>l2frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mine</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a layer 2 frame to all built-in protocol implementations that are interested in it. </p>
<ul>
<li><code>l2frame</code> A pointer to the L2 frame (has L2+ headers) </li>
<li><code>mine</code> A boolean flag that indicates if the packet is "for" this node.</li>
</ul>
<p>Sends a L2 frame (including full L2 header) to the libfish built-in protocol implementations. This must be used in the order depicted in the flow chart above. The "mine" parameter enables both promiscuous and non-promiscious builtin functions. This function returns true if the frame was "consumed" and should not be processed further. If the function returns false then further processing is needed. </p>

</div>
</div>
<a class="anchor" id="ga114eafd3ec0fb43a7d4785c4f3f2932e"></a><!-- doxytag: member="fish.h::fnl2_ntoa" ref="ga114eafd3ec0fb43a7d4785c4f3f2932e" args="(fn_l2addr_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* fnl2_ntoa </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Converts a L2 address into a printable c-string. </p>
<ul>
<li><code>addr</code> The L2 address to convert <dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the c-string that contains the L2 address</dd></dl>
Warning - This function places the string into a static buffer, so if you call this function twice it will overwrite the result from the first call. Don't use this twice in the same call to printf()! </li>
</ul>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga2df87dd135076789b17a5166d2b5e4fc"></a><!-- doxytag: member="fish.h::ALL_L2_NEIGHBORS" ref="ga2df87dd135076789b17a5166d2b5e4fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfn__l2addr__t.html">fn_l2addr_t</a> <a class="el" href="group___l2.html#ga2df87dd135076789b17a5166d2b5e4fc">ALL_L2_NEIGHBORS</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A global that holds the L2 broadcast address. </p>

</div>
</div>
<a class="anchor" id="gace8427af2028b1c5e79bfa46b65624e6"></a><!-- doxytag: member="fish.h::fish_l2" ref="gace8427af2028b1c5e79bfa46b65624e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="struct_fishnet_l2_funcs.html">FishnetL2Funcs</a>  <a class="el" href="group___l2.html#gace8427af2028b1c5e79bfa46b65624e6">fish_l2</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Functions for transmitting and receiving L2 frames. </p>
<p>This structure contains function pointers that implement all layer 2 transmit and receive operations. Layer 2 frames have the layer 2 header and any layer 2 payload. These are provided as function pointers to allow the fishnode to override the built-in implementations with its own implementation(s).</p>
<p>There is a single instance of this structure in a fishnode. It is a global variable named fish_l2. You can access the fields directly in any portion of your code (e.g., fish_l2.fishnode_l2_receive = NULL) to change the value of the function pointers or to call them. Do not declare an instance of this structure yourself. </p>

</div>
</div>
<a class="anchor" id="gafa9566a45fa67b25adefe2ded4ca24fa"></a><!-- doxytag: member="FishnetL2Funcs::fish_l2_receive" ref="gafa9566a45fa67b25adefe2ded4ca24fa" args=")(void *l2frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l2.html#gafa9566a45fa67b25adefe2ded4ca24fa">FishnetL2Funcs::fish_l2_receive</a>)(void *l2frame)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive a new layer 2 frame from the layer 1 code. </p>
<ul>
<li><code>l2frame</code> A pointer to the received L2 frame. The frame must not be modified. The caller will free the memory for the frame as necessary. <dl class="return"><dt><b>Returns:</b></dt><dd>false if the receive is known to have failed and true otherwise.</dd></dl>
This function is the main function responsible for accepting new L2 packets from the L1 code. It is responsible for calling <a class="el" href="group___l2.html#ga418e3070cc441741aa9435e8c3683b48" title="Sends a L2 frame to applications that are attached to this node.">fish_sendto_l2_apps()</a>, <a class="el" href="group___l2.html#ga1fa801f4576bc4ffe79398493a63f697" title="Sends a layer 2 frame to all built-in protocol implementations that are interested...">fish_sendto_l2_builtin()</a>, and <a class="el" href="group___l2.html#ga2f74da6dde0fbc3cb18f5ce5a102cfb0" title="Receives a new layer 2 frame from the layer 1 code in libfish. Decapsulates the frame...">fishnode_l2_receive()</a>, in that order. It does nothing more than call those 3 functions. All remaining L2 logic is left for fish_l2::fishnode_l2_receive. </li>
</ul>

</div>
</div>
<a class="anchor" id="gabba01bfaace8950157d419097386254f"></a><!-- doxytag: member="FishnetL2Funcs::fish_l2_send" ref="gabba01bfaace8950157d419097386254f" args=")(void *l3frame, fnaddr_t next_hop, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l2.html#gabba01bfaace8950157d419097386254f">FishnetL2Funcs::fish_l2_send</a>)(void *l3frame, <a class="el" href="group___l3.html#ga56eb193582cf90391b0719f7ec51bde1">fnaddr_t</a> next_hop, int len)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receives a new L3 frame to be sent over the network. </p>
<ul>
<li><code>l3frame</code> A pointer to the L3 frame. The original frame memory must not be modified. The caller is responsible for freeing any memory after this function has completed. </li>
<li><code>next_hop</code> The L3 address of the neighbor this frame should be sent to. </li>
<li><code>len</code> The length of the L3 frame <dl class="return"><dt><b>Returns:</b></dt><dd>false if the send is known to have failed and true otherwise.</dd></dl>
This function takes to following steps to transmit <code>l3frame:</code> </li>
<li>Adds an L2 header to the frame </li>
<li>Uses the ARP cache to resolve the L3 address to L2 (see <a class="el" href="group___a_r_p.html">ARP Functionality</a>) </li>
<li>Calls <a class="el" href="group___l1.html#gaf64a071e28b979742ef6a520198018c9" title="fish_l1_send sends a L2+ frame through the fishnet overlay.">fish_l1_send()</a> to transmit the frame </li>
</ul>

</div>
</div>
<a class="anchor" id="ga2f74da6dde0fbc3cb18f5ce5a102cfb0"></a><!-- doxytag: member="FishnetL2Funcs::fishnode_l2_receive" ref="ga2f74da6dde0fbc3cb18f5ce5a102cfb0" args=")(void *l2frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group___l2.html#ga2f74da6dde0fbc3cb18f5ce5a102cfb0">FishnetL2Funcs::fishnode_l2_receive</a>)(void *l2frame)<code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receives a new layer 2 frame from the layer 1 code in libfish. Decapsulates the frame and passes it up the stack as needed. </p>
<ul>
<li><code>l2frame</code> A pointer to the received L2 frame. The frame must not be modified. The caller will free the memory for the frame as necessary. <dl class="return"><dt><b>Returns:</b></dt><dd>false if the receive is known to have failed and true otherwise.</dd></dl>
This function is responsible for correctly directing valid packets to the higher network layers. This requires following general steps: </li>
<li>Dropping frames with invalid checksums </li>
<li>Dropping frames that are not destined for this node (verifies the L2 address. doesn't consider the L3 address). </li>
<li>Decapsulating frame and passing up the stack (fish_l3::fish_l3_receive).</li>
</ul>
<p>This is also the function that calls your implementation of fishnet L2 protocols, such as ARP. </p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 14 Jan 2014 for Fishnet by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
